<header>
  <div class="cover"></div>
  <h1>More Details</h1>
</header>


<div class="content">
  <div @placeState *ngIf="(state | async).loading !== 'page' && (state | async).error !== 'page'">
    <div class="title">
      <h4 class="nowrap">
        <strong>{{ (state | async).place.name }}</strong> {{ (state | async).place.location.city }}</h4>
      <p>
        <vn-stars [rating]="(state | async).place.rating"></vn-stars>
      </p>
    </div>
    <div class="details flex wrap">
      <div class="page-left">
        <h3>Information</h3>
        <div class="flex wrap w-100 mb-1">
          <div class="info categories">
            <i class="mdi mdi-silverware-variant mdi-24px"></i>
            <div class="text">
              <h5>Categories</h5>
              <div>
                <span *ngFor="let category of (state | async).place.categories">{{ category.title }}</span>
              </div>
            </div>
          </div>
          <div class="info address">
            <i class="mdi mdi-map-marker mdi-24px"></i>
            <div class="text">
              <h5>Address</h5>
              <div>
                <span *ngFor="let address of (state | async).place.location.display_address">{{ address }}</span>
              </div>
            </div>
          </div>
          <div class="info phone" *ngIf="(state | async).place.display_phone">
            <i class="mdi mdi-phone mdi-24px"></i>
            <div class="text">
              <h5>Phone</h5>
              <a [href]="'tel:' + (state | async).place.phone">{{ (state | async).place.display_phone }}</a>
              <span></span>
            </div>
          </div>
          <div class="info price" *ngIf="(state | async).place.price">
            <i class="mdi mdi-currency-usd mdi-24px"></i>
            <div class="text">
              <h5>Price</h5>
              <vn-price [price]="(state | async).place.price" [textOnly]="true"></vn-price>
            </div>
          </div>
        </div>
        <h3>Map</h3>
        <agm-map class="mb-2" [latitude]="(state | async).place.coordinates.latitude" [longitude]="(state | async).place.coordinates.longitude"
          [scrollwheel]="false" [styles]="mapStyles" [zoom]="17">
          <agm-marker [latitude]="(state | async).place.coordinates.latitude" [longitude]="(state | async).place.coordinates.longitude"
            [iconUrl]="'assets/icons/marker.png'">
          </agm-marker>
        </agm-map>

        <div class="reviews mb-3" *ngIf="(state | async).reviews?.reviews.length">
          <h3>Latest Reviews</h3>
          <ul>
            <li *ngFor="let review of (state | async).reviews.reviews">
              <div class="user flex align-items-center">
                <img [src]="review.user.image_url || 'assets/images/user_review.png'">
                <div class="details">
                  <h6 class="m-0">{{ review.user.name }}</h6>
                  <div class="flex align-items-center">
                    <vn-stars [rating]="review.rating"></vn-stars>
                    <div class="date">{{ review.time_created }}</div>
                  </div>

                </div>
              </div>
              <div class="text">
                <p>{{ review.text.slice(0, -3) }}
                  <a [href]="review.url" target="_blank">read more...</a>
                </p>
              </div>
            </li>
          </ul>
          <!-- reviews error message -->
          <div class="error center-align align-self-flex-start w-70 py-2" *ngIf="(state | async).error === 'reviews'" @errorState>
            <h3>Connection Error</h3>
            <p>Ooops, something went wromg. Please try again later.</p>
            <button mz-button (click)="onReloadReviews()">Try Again</button>
          </div>

          <!-- reviews loader -->
          <div class="spinner-wrap mt-2" *ngIf="(state | async).loading === 'reviews'">
            <mz-spinner color="blue" size="medium"></mz-spinner>
          </div>
        </div>
      </div>
      <!-- <vn-btn-favorite [placeId]="(state | async).place.id" [placeName]="(state | async).place.name"></vn-btn-favorite> -->
      <div class="page-right">
        <ng-container *ngIf="(state | async).place.hours">
          <div class="inline flex align-items-center mb-1">
            <h3>Working Hours</h3>
            <span class="is-open ml-auto" [vnBgColor]="isOpen ? 'tertiary' : 'danger'">Now {{ isOpen ? 'Open' : 'Closed' }}</span>
          </div>
          <ul class="mt-0 mb-2">
            <ng-container *ngFor="let day of (state | async).place.hours[0].open; let i = index">
              <ng-container *ngIf="i === 0 || (state | async).place.hours[0].open[i - 1].day !== day.day; else sameDay">
                <li>
                  <strong>{{ day.day | day }}</strong> {{ (day.start | hour) + ' - ' + (day.end | hour) }}</li>
              </ng-container>
              <ng-template #sameDay>
                <li class="same-day">{{ (day.start | hour) + ' - ' + (day.end | hour) }}</li>
              </ng-template>
            </ng-container>
          </ul>
        </ng-container>

        <h3>Transactions</h3>
        <ul class="m-0 mb-2">
          <li>
            <strong>Pickup</strong>
            <i class="mdi mdi-24px" [ngClass]="transactions.pickup ? 'mdi-checkbox-marked' : 'mdi-checkbox-blank-outline'" vnColor="tertiary"></i>
          </li>
          <li>
            <strong>Delivery</strong>
            <i class="mdi mdi-24px" [ngClass]="transactions.delivery ? 'mdi-checkbox-marked' : 'mdi-checkbox-blank-outline'" vnColor="tertiary"></i>
          </li>
          <li>
            <strong>Reservation</strong>
            <i class="mdi mdi-24px" [ngClass]="transactions.reservation ? 'mdi-checkbox-marked' : 'mdi-checkbox-blank-outline'" vnColor="tertiary"></i>
          </li>
        </ul>

        <h3>Images</h3>
        <div [ngClass]="{'justify-content-space-between': (state | async).place.photos.length === 3}" class="images flex">
          <img [src]="image" *ngFor="let image of (state | async).place.photos; let i = index" (click)="openLightbox(i)">
        </div>
      </div>
    </div>
  </div>

  <!-- page error message -->
  <div class="error center-align align-self-flex-start w-70 py-2 mx-auto" *ngIf="(state | async).error === 'page'" @errorState>
    <h3>Place Not Found</h3>
    <p>Ooops, something went wromg. Please try again later.</p>
    <p>*If this message not eventually replaced, the required place may not be reachable anymore.</p>
    <button mz-button (click)="onReloadPage()">Try Again</button>
  </div>

  <!-- page loader -->
  <div class="spinner-container flex align-items-center justify-content-center" *ngIf="(state | async).loading === 'page'">
    <mz-spinner size="big" color="blue"></mz-spinner>
  </div>
</div>